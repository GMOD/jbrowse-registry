//>>built
require({cache:{"JBrowse/Model/DataView":function(){define("JBrowse/Model/DataView",["jDataView"],function(p){var m=function(){p.apply(this,arguments)};try{m.prototype=new p(new ArrayBuffer([1]),0,1)}catch(a){console.error(a)}m.prototype.getUint64Approx=function(a,h){var i=this._getBytes(8,a,h),c=i[0]*Math.pow(2,56)+i[1]*Math.pow(2,48)+i[2]*Math.pow(2,40)+i[3]*Math.pow(2,32)+i[4]*Math.pow(2,24)+(i[5]<<16)+(i[6]<<8)+i[7];if(i[0]||i[1]&224)c=Number(c),c.overflow=!0;return c};m.prototype.getUint64=function(a,
h){var i=this.getUint64Approx(a,h);if(i.overflow)throw Error("integer overflow");return i};return m})},"jDataView/jdataview":function(){define("jDataView/jdataview",[],function(){var p={};(function(m){var a={ArrayBuffer:"undefined"!==typeof ArrayBuffer,DataView:"undefined"!==typeof DataView&&("getFloat64"in DataView.prototype||"getFloat64"in new DataView(new ArrayBuffer(1))),NodeBuffer:"undefined"!==typeof Buffer&&"readInt16LE"in Buffer.prototype},j={Int8:1,Int16:2,Int32:4,Uint8:1,Uint16:2,Uint32:4,
Float32:4,Float64:8},h={Int8:"Int8",Int16:"Int16",Int32:"Int32",Uint8:"UInt8",Uint16:"UInt16",Uint32:"UInt32",Float32:"Float",Float64:"Double"},i=function(c,e,b,f){if(!(this instanceof i))throw Error("jDataView constructor may not be called as a function");this.buffer=c;if(!(a.NodeBuffer&&c instanceof Buffer)&&!(a.ArrayBuffer&&c instanceof ArrayBuffer)&&"string"!==typeof c)throw new TypeError("jDataView buffer has an incompatible type");this._isArrayBuffer=a.ArrayBuffer&&c instanceof ArrayBuffer;
this._isDataView=a.DataView&&this._isArrayBuffer;this._isNodeBuffer=a.NodeBuffer&&c instanceof Buffer;this._littleEndian=Boolean(f);var l=this._isArrayBuffer?c.byteLength:c.length;void 0===e&&(e=0);this.byteOffset=e;void 0===b&&(b=l-e);this.byteLength=b;if(!this._isDataView){if("number"!==typeof e)throw new TypeError("jDataView byteOffset is not a number");if("number"!==typeof b)throw new TypeError("jDataView byteLength is not a number");if(0>e)throw Error("jDataView byteOffset is negative");if(0>
b)throw Error("jDataView byteLength is negative");}if(this._isDataView)this._view=new DataView(c,e,b),this._start=0;this._start=e;if(e+b>l)throw Error("jDataView (byteOffset + byteLength) value is out of bounds");this._offset=0;if(this._isDataView)for(var n in j)j.hasOwnProperty(n)&&function(l,d){var g=j[l];d["get"+l]=function(k,b){if(void 0===b)b=d._littleEndian;if(void 0===k)k=d._offset;d._offset=k+g;return d._view["get"+l](k,b)}}(n,this);else if(this._isNodeBuffer&&a.NodeBuffer)for(n in j)j.hasOwnProperty(n)&&
function(l,d,g){var b=j[l];d["get"+l]=function(l){if(void 0===l)l=d._offset;d._offset=l+b;return d.buffer[g](d._start+l)}}(n,this,"Int8"===n||"Uint8"===n?"read"+h[n]:f?"read"+h[n]+"LE":"read"+h[n]+"BE");else for(n in j)j.hasOwnProperty(n)&&function(l,d){var g=j[l];d["get"+l]=function(b,c){if(void 0===c)c=d._littleEndian;if(void 0===b)b=d._offset;d._offset=b+g;if(d._isArrayBuffer&&0===(d._start+b)%g&&(1===g||c))return(new m[l+"Array"](d.buffer,d._start+b,1))[0];if("number"!==typeof b)throw new TypeError("jDataView byteOffset is not a number");
if(b+g>d.byteLength)throw Error("jDataView (byteOffset + size) value is out of bounds");return d["_get"+l](d._start+b,c)}}(n,this)};i.createBuffer=a.NodeBuffer?function(){return new Buffer(arguments)}:a.ArrayBuffer?function(){return(new Uint8Array(arguments)).buffer}:function(){return String.fromCharCode.apply(null,arguments)};i.prototype={compatibility:a,_getBytes:function(c,e,b){var a;if(void 0===b)b=this._littleEndian;if(void 0===e)e=this._offset;if("number"!==typeof e)throw new TypeError("jDataView byteOffset is not a number");
if(0>c||e+c>this.byteLength)throw Error("jDataView length or (byteOffset+length) value is out of bounds");e+=this._start;this._isArrayBuffer?a=new Uint8Array(this.buffer,e,c):(a=this.buffer.slice(e,e+c),this._isNodeBuffer||(a=Array.prototype.map.call(a,function(l){return l.charCodeAt(0)&255})));b&&1<c&&(a instanceof Array||(a=Array.prototype.slice.call(a)),a.reverse());this._offset=e-this._start+c;return a},getBytes:function(c,a,b){var f=this._getBytes.apply(this,arguments);f instanceof Array||(f=
Array.prototype.slice.call(f));return f},getString:function(c,a){var b;if(this._isNodeBuffer){if(void 0===a)a=this._offset;if("number"!==typeof a)throw new TypeError("jDataView byteOffset is not a number");if(0>c||a+c>this.byteLength)throw Error("jDataView length or (byteOffset+length) value is out of bounds");b=this.buffer.toString("ascii",this._start+a,this._start+a+c);this._offset=a+c}else b=String.fromCharCode.apply(null,this._getBytes(c,a,!1));return b},getChar:function(c){return this.getString(1,
c)},tell:function(){return this._offset},seek:function(c){if("number"!==typeof c)throw new TypeError("jDataView byteOffset is not a number");if(0>c||c>this.byteLength)throw Error("jDataView byteOffset value is out of bounds");return this._offset=c},_getFloat64:function(c,a){var b=this._getBytes(8,c,a),f=1-2*(b[0]>>7),l=((b[0]<<1&255)<<3|b[1]>>4)-(Math.pow(2,10)-1),b=(b[1]&15)*Math.pow(2,48)+b[2]*Math.pow(2,40)+b[3]*Math.pow(2,32)+b[4]*Math.pow(2,24)+b[5]*Math.pow(2,16)+b[6]*Math.pow(2,8)+b[7];return 1024===
l?0!==b?NaN:Infinity*f:-1023===l?f*b*Math.pow(2,-1074):f*(1+b*Math.pow(2,-52))*Math.pow(2,l)},_getFloat32:function(c,a){var b=this._getBytes(4,c,a),f=1-2*(b[0]>>7),l=(b[0]<<1&255|b[1]>>7)-127,b=(b[1]&127)<<16|b[2]<<8|b[3];return 128===l?0!==b?NaN:Infinity*f:-127===l?f*b*Math.pow(2,-149):f*(1+b*Math.pow(2,-23))*Math.pow(2,l)},_getInt32:function(c,a){var b=this._getUint32(c,a);return b>Math.pow(2,31)-1?b-Math.pow(2,32):b},_getUint32:function(a,e){var b=this._getBytes(4,a,e);return b[0]*Math.pow(2,24)+
(b[1]<<16)+(b[2]<<8)+b[3]},_getInt16:function(a,e){var b=this._getUint16(a,e);return b>Math.pow(2,15)-1?b-Math.pow(2,16):b},_getUint16:function(a,e){var b=this._getBytes(2,a,e);return(b[0]<<8)+b[1]},_getInt8:function(a){a=this._getUint8(a);return a>Math.pow(2,7)-1?a-Math.pow(2,8):a},_getUint8:function(a){return this._getBytes(1,a)[0]}};"undefined"!==typeof jQuery&&"1.6.2"<=jQuery.fn.jquery&&(jQuery.ajaxSetup({converters:{"* dataview":function(a){return new i(a)}},accepts:{dataview:"text/plain; charset=x-user-defined"},
responseHandler:{dataview:function(a,e,b){var f;if("mozResponseArrayBuffer"in b)f=b.mozResponseArrayBuffer;else if("responseType"in b&&"arraybuffer"===b.responseType&&b.response)f=b.response;else if("responseBody"in b){e=b.responseBody;try{f=IEBinaryToArray_ByteStr(e)}catch(l){window.execScript("Function IEBinaryToArray_ByteStr(Binary)\r\n\tIEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n\tDim lastIndex\r\n\tlastIndex = LenB(Binary)\r\n\tif lastIndex mod 2 Then\r\n\t\tIEBinaryToArray_ByteStr_Last = AscB( MidB( Binary, lastIndex, 1 ) )\r\n\tElse\r\n\t\tIEBinaryToArray_ByteStr_Last = -1\r\n\tEnd If\r\nEnd Function\r\n",
"vbscript"),f=IEBinaryToArray_ByteStr(e)}for(var e=IEBinaryToArray_ByteStr_Last(e),b="",n=0,r=f.length%8,d;n<r;)d=f.charCodeAt(n++),b+=String.fromCharCode(d&255,d>>8);for(r=f.length;n<r;)b+=String.fromCharCode((d=f.charCodeAt(n++),d&255),d>>8,(d=f.charCodeAt(n++),d&255),d>>8,(d=f.charCodeAt(n++),d&255),d>>8,(d=f.charCodeAt(n++),d&255),d>>8,(d=f.charCodeAt(n++),d&255),d>>8,(d=f.charCodeAt(n++),d&255),d>>8,(d=f.charCodeAt(n++),d&255),d>>8,(d=f.charCodeAt(n++),d&255),d>>8);-1<e&&(b+=String.fromCharCode(e));
f=b}else f=b.responseText;a.text=f}}}),jQuery.ajaxPrefilter("dataview",function(a){if(jQuery.support.ajaxResponseType){if(!a.hasOwnProperty("xhrFields"))a.xhrFields={};a.xhrFields.responseType="arraybuffer"}a.mimeType="text/plain; charset=x-user-defined"}));m.jDataView=(m.module||{}).exports=i;if("undefined"!==typeof module)module.exports=i})(p);return p.jDataView})},"JBrowse/Store/SeqFeature/BigWig/Window":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","./RequestWorker"],
function(p,m,a,j){return p(null,{constructor:function(a,i,c,e){this.bwg=a;if(!(0<=i))throw"invalid cirTreeOffset!";if(!(0<c))throw"invalid cirTreeLength!";this.cirTreeOffset=i;this.cirTreeLength=c;this.isSummary=e},BED_COLOR_REGEXP:/^[0-9]+,[0-9]+,[0-9]+/,readWigData:function(a,i,c,e,b){(a=this.bwg.refsByName[a])?this.readWigDataById(a.id,i,c,e,b):e([])},readWigDataById:function(h,i,c,e,b){this.cirHeader?(new j(this,h,i,c,e,b)).cirFobRecur([this.cirTreeOffset+48],1):(h=m.hitch(this,"readWigDataById",
h,i,c,e,b),this.cirHeaderLoading?this.cirHeaderLoading.push(h):(this.cirHeaderLoading=[h],this.bwg.data.read(this.cirTreeOffset,48,m.hitch(this,function(b){this.cirHeader=b;this.cirBlockSize=this.bwg.newDataView(b,4,4).getUint32();a.forEach(this.cirHeaderLoading,function(a){a()});delete this.cirHeaderLoading}),b)))}})})},"JBrowse/Store/SeqFeature/BigWig/RequestWorker":function(){define("dojo/_base/declare,dojo/_base/lang,dojo/_base/array,JBrowse/Util,JBrowse/Util/RejectableFastPromise,dojo/promise/all,JBrowse/Model/Range,JBrowse/Model/SimpleFeature,jszlib/inflate,jszlib/arrayCopy".split(","),
function(p,m,a,j,h,i,c,e,b){var f=function(){console.log.apply(console,arguments)};return p(null,{BIG_WIG_TYPE_GRAPH:1,BIG_WIG_TYPE_VSTEP:2,BIG_WIG_TYPE_FSTEP:3,constructor:function(a,b,c,d,g,k){this.window=a;this.source=a.bwg.name||void 0;this.blocksToFetch=[];this.outstanding=0;this.chr=b;this.min=c;this.max=d;this.callback=g;this.errorCallback=k||function(d){console.error(d,d.stack,arguments.caller)}},cirFobRecur:function(a,b){this.outstanding+=a.length;for(var r=4+32*this.window.cirBlockSize,
d,g=0;g<a.length;++g){var k=new c(a[g],Math.min(a[g]+r,this.window.cirTreeOffset+this.window.cirTreeLength));d=d?d.union(k):k}r=d.ranges();for(d=0;d<r.length;++d)this.cirFobStartFetch(a,r[d],b)},cirFobStartFetch:function(a,b,c){var d=b.max()-b.min();this.window.bwg._read(b.min(),d,m.hitch(this,function(d){for(var k=0;k<a.length;++k)b.contains(a[k])&&(this.cirFobRecur2(d,a[k]-b.min(),c),--this.outstanding,0==this.outstanding&&this.cirCompleted())}),this.errorCallback)},cirFobRecur2:function(a,b,c){var a=
this.window.bwg.newDataView(a,b),d=a.getUint8(),b=a.getUint16(2);if(0!=d)for(d=0;d<b;++d){var g=a.getUint32(),k=a.getUint32(),e=a.getUint32(),f=a.getUint32(),i=a.getUint64(),c=a.getUint64();(g<this.chr||g==this.chr&&k<=this.max)&&(e>this.chr||e==this.chr&&f>=this.min)&&this.blocksToFetch.push({offset:i,size:c})}else{for(var o=[],d=0;d<b;++d)g=a.getUint32(),k=a.getUint32(),e=a.getUint32(),f=a.getUint32(),i=a.getUint64(),(g<this.chr||g==this.chr&&k<=this.max)&&(e>this.chr||e==this.chr&&f>=this.min)&&
o.push(i);0<o.length&&this.cirFobRecur(o,c+1)}},cirCompleted:function(){this.blockGroupsToFetch=this.groupBlocks(this.blocksToFetch);0==this.blockGroupsToFetch.length?this.callback([]):(this.features=[],this.readFeatures())},groupBlocks:function(a){a.sort(function(a,d){return(a.offset|0)-(d.offset|0)});for(var b=[],c,d,g=0;g<a.length;g++)c&&2E3>=a[g].offset-d?(c.size+=a[g].size-d+a[g].offset,c.blocks.push(a[g])):b.push(c={blocks:[a[g]],size:a[g].size,offset:a[g].offset}),d=c.offset+c.size;return b},
createFeature:function(a,b,c){var a={start:a,end:b,source:this.source},d;for(d in c)a[d]=c[d];this.features.push(new e({data:a}))},maybeCreateFeature:function(a,b,c){a<=this.max&&b>=this.min&&this.createFeature(a,b,c)},parseSummaryBlock:function(a,b){for(var c=this.window.bwg.newDataView(a,b),d=a.byteLength/32,g=0;g<d;++g){var k=c.getInt32(),e=c.getInt32(),f=c.getInt32(),i=c.getInt32()||1,o=c.getFloat32(),j=c.getFloat32(),h=c.getFloat32();c.getFloat32();if(k==this.chr){k={score:h/i,maxScore:j,minScore:o};
if("bigbed"==this.window.bwg.type)k.type="density";this.maybeCreateFeature(e,f,k)}}},parseBigWigBlock:function(a,b){var c=this.window.bwg.newDataView(a,b),d=c.getUint32(16),g=c.getUint8(20),k=c.getUint16(22);if(g==this.BIG_WIG_TYPE_FSTEP)for(var e=c.getInt32(4),i=c.getUint32(12),g=0;g<k;++g){var j=c.getFloat32(4*g+24);this.maybeCreateFeature(e+g*i,e+g*i+d,{score:j})}else if(g==this.BIG_WIG_TYPE_VSTEP)for(g=0;g<k;++g)e=c.getInt32(8*g+24),j=c.getFloat32(),this.maybeCreateFeature(e,e+d,{score:j});else if(g==
this.BIG_WIG_TYPE_GRAPH)for(g=0;g<k;++g)e=c.getInt32(12*g+24),d=c.getInt32(),j=c.getFloat32(),e>d&&(e=d),this.maybeCreateFeature(e,d,{score:j});else f("Currently not handling bwgType="+g)},parseBigBedBlock:function(a,b){for(var i=this.window.bwg.newDataView(a,b),d=0;d<a.length;){for(var g=i.getUint32(d),k=i.getInt32(d+4),j=i.getInt32(d+8),d=d+12,f="";d<a.length;){var h=i.getUint8(d++);if(0!=h)f+=String.fromCharCode(h);else break}var h={},o=f.split("\t");if(0<o.length)h.label=o[0];if(1<o.length)h.score=
parseInt(o[1]);if(2<o.length)h.orientation=o[2];if(5<o.length&&(f=o[5],this.window.BED_COLOR_REGEXP.test(f)))h.override_color="rgb("+f+")";if(9>o.length)g==this.chr&&this.maybeCreateFeature(k,j,h);else if(g==this.chr&&k<=this.max&&j>=this.min){var g=o[3]|0,j=o[4]|0,f=o[6]|0,m=o[7].split(","),p=o[8].split(",");h.type="bb-transcript";var q=new e;q.id=o[0];q.type="bb-transcript";q.notes=[];h.groups=[q];if(10<o.length){var q=o[9],o=o[10],s=new e;s.id=q;s.label=o;s.type="gene";h.groups.push(s)}o=null;
for(q=0;q<f;++q)s=(p[q]|0)+k,s=new c(s,s+(m[q]|0)),o=o?o.union(s):s;m=o.ranges();for(k=0;k<m.length;++k)f=m[k],this.createFeature(f.min(),f.max(),h);if(j>g&&(k=o.intersection(new c(g,j)))){h.type="bb-translation";g=k.ranges();for(k=0;k<g.length;++k)f=g[k],this.createFeature(f.min(),f.max(),h)}}}},readFeatures:function(){var c=this,e=a.map(c.blockGroupsToFetch,function(a){var d=new h;c.window.bwg._read(a.offset,a.size,function(b){a.data=b;d.resolve(a)},m.hitch(d,"reject"));return d},c);i(e).then(function(e){a.forEach(e,
function(d){a.forEach(d.blocks,function(a){var k=a.offset-d.offset;0<c.window.bwg.uncompressBufSize?(a=b(d.data,k+2,a.size-2),k=0):a=d.data;c.window.isSummary?c.parseSummaryBlock(a,k):"bigwig"==c.window.bwg.type?c.parseBigWigBlock(a,k):"bigbed"==c.window.bwg.type?c.parseBigBedBlock(a,k):f("Don't know what to do with "+c.window.bwg.type)})});c.callback(c.features)},c.errorCallback)}})})},"JBrowse/Util/RejectableFastPromise":function(){define([],function(){var p=function(){this.callbacks=[];this.errbacks=
[]};p.prototype.then=function(m,a){"value"in this?m(this.value):"error"in this?a(this.error):(this.callbacks.push(m),this.errbacks.push(a))};p.prototype.resolve=function(m){this.value=m;delete this.errbacks;m=this.callbacks;delete this.callbacks;for(var a=0;a<m.length;a++)m[a](this.value)};p.prototype.reject=function(m){this.error=m;delete this.callbacks;var a=this.errbacks;delete this.errbacks;for(var j=0;j<a.length;j++)a[j](m)};return p})},"JBrowse/Model/Range":function(){define("JBrowse/Model/Range",
["dojo/_base/declare"],function(p){var m=p(null,{constructor:function(){this._ranges=2==arguments.length?[{min:arguments[0],max:arguments[1]}]:0 in arguments[0]?dojo.clone(arguments[0]):[arguments[0]]},min:function(){return this._ranges[0].min},max:function(){return this._ranges[this._ranges.length-1].max},contains:function(a){for(var j=0;j<this._ranges.length;++j){var h=this._ranges[j];if(h.min<=a&&h.max>=a)return!0}return!1},isContiguous:function(){return 1<this._ranges.length},ranges:function(){return this._ranges.map(function(a){return new m(a.min,
a.max)})},toString:function(){return this._ranges.map(function(a){return"["+a.min+"-"+a.max+"]"}).join(",")},union:function(a){for(var a=this.ranges().concat(a.ranges()).sort(this.rangeOrder),j=[],h=a[0],i=1;i<a.length;++i){var c=a[i];c.min()>h.max()+1?(j.push(h),h=c):c.max()>h.max()&&(h=new m(h.min(),c.max()))}j.push(h);if(1==j.length)return j[0];alert("unknown error: _Compound")},intersection:function(a){for(var j,h=this.ranges(),i=a.ranges(),c=h.length,e=i.length,b=0,f=0,l=[];b<c&&f<e;){j=h[b];
var a=i[f],n=Math.max(j.min(),a.min()),p=Math.min(j.max(),a.max());p>=n&&l.push(new m(n,p));j.max()>a.max()?++f:++b}if(0==l.length)return null;if(1==l.length)return l[0];alert("unknown error: _Compound")},coverage:function(){for(var a=0,j=this.ranges(),h=0;h<j.length;++h)var i=j[h],a=a+(i.max()-i.min()+1);return a},rangeOrder:function(a,j){2>arguments.length&&(j=a,a=this);return a.min()<j.min()?-1:a.min()>j.min()?1:a.max()<j.max()?-1:j.max()>a.max()?1:0}});return m})}}});
define("JBrowse/Store/SeqFeature/BigWig","dojo/_base/declare,dojo/_base/lang,dojo/_base/array,dojo/_base/url,JBrowse/Model/DataView,JBrowse/has,JBrowse/Errors,JBrowse/Store/SeqFeature,JBrowse/Store/DeferredStatsMixin,JBrowse/Store/DeferredFeaturesMixin,./BigWig/Window,JBrowse/Util,JBrowse/Model/XHRBlob".split(","),function(p,m,a,j,h,i,c,e,b,f,l,n,r){return p([e,b,f],{BIG_WIG_MAGIC:-2003829722,BIG_BED_MAGIC:-2021002517,BIG_WIG_TYPE_GRAPH:1,BIG_WIG_TYPE_VSTEP:2,BIG_WIG_TYPE_FSTEP:3,_littleEndian:!0,
constructor:function(a){this.data=a.blob||new r(this.resolveUrl(a.urlTemplate||"data.bigwig"));this.name=a.name||this.data.url&&(new j(this.data.url)).path.replace(/^.+\//,"")||"anonymous";this._load()},_defaultConfig:function(){return n.deepUpdate(dojo.clone(this.inherited(arguments)),{chunkSizeLimit:3E7})},_getGlobalStats:function(a){var b=this._globalStats||{};if(!("scoreMean"in b))b.scoreMean=b.basesCovered?b.scoreSum/b.basesCovered:0;if(!("scoreStdDev"in b))b.scoreStdDev=this._calcStdFromSums(b.scoreSum,
b.scoreSumSquares,b.basesCovered);a(b)},_read:function(a,b,k,e){b>this.config.chunkSizeLimit?e(new c.DataOverflow("Too much data. Chunk size "+n.commifyNumber(b)+" bytes exceeds chunkSizeLimit of "+n.commifyNumber(this.config.chunkSizeLimit)+".")):this.data.read.apply(this.data,arguments)},_load:function(){this._read(0,512,m.hitch(this,function(a){if(a){var b=this.newDataView(a),c=b.getInt32();if(c!=this.BIG_WIG_MAGIC&&c!=this.BIG_BED_MAGIC&&(this._littleEndian=!1,b=this.newDataView(a),b.getInt32()!=
this.BIG_WIG_MAGIC&&c!=this.BIG_BED_MAGIC)){console.error("Not a BigWig or BigBed file");this._deferred.reject("Not a BigWig or BigBed file");return}this.type=c==this.BIG_BED_MAGIC?"bigbed":"bigwig";(this.fileSize=a.fileSize)||console.warn("cannot get size of BigWig/BigBed file, widest zoom level not available");this.version=b.getUint16();this.numZoomLevels=b.getUint16();this.chromTreeOffset=b.getUint64();this.unzoomedDataOffset=b.getUint64();this.unzoomedIndexOffset=b.getUint64();this.fieldCount=
b.getUint16();this.definedFieldCount=b.getUint16();this.asOffset=b.getUint64();this.totalSummaryOffset=b.getUint64();this.uncompressBufSize=b.getUint32();this.zoomLevels=[];for(c=0;c<this.numZoomLevels;++c){var e=b.getUint32(4*(6*c+16)),f=b.getUint64(4*(6*c+18)),i=b.getUint64(4*(6*c+20));this.zoomLevels.push({reductionLevel:e,dataOffset:f,indexOffset:i})}this.totalSummaryOffset?function(){var b=this.newDataView(a,this.totalSummaryOffset);this._globalStats={basesCovered:b.getUint64(),scoreMin:b.getFloat64(),
scoreMax:b.getFloat64(),scoreSum:b.getFloat64(),scoreSumSquares:b.getFloat64()}}.call(this):console.warn("BigWig "+this.data.url+" has no total summary data.");this._readChromTree(function(){this._deferred.features.resolve({success:!0});this._deferred.stats.resolve({success:!0})},m.hitch(this,"_failAllDeferred"))}else this._failAllDeferred("BBI header not readable")}),m.hitch(this,"_failAllDeferred"))},newDataView:function(a,b,c){return new h(a,b,c,this._littleEndian)},_readChromTree:function(a,b){var c=
this;this.refsByNumber={};this.refsByName={};for(var e=this.unzoomedDataOffset;0!=e%4;)++e;this._read(this.chromTreeOffset,e-this.chromTreeOffset,function(b){if(i("typed-arrays")){var e=c.newDataView(b);if(2026540177!==e.getUint32())throw"parse error: not a Kent bPlusTree";e.getUint32();var g=e.getUint32();e.getUint32();e.getUint64();var f=function(a){if(a>=b.length)throw"reading beyond end of buffer";for(var d=e.getUint8(a),i=e.getUint16(a+2),a=a+4,j=0;j<i;++j)if(d){for(var h="",m=0;m<g;++m){var l=
e.getUint8(a++);0!=l&&(h+=String.fromCharCode(l))}m=e.getUint32(a);l=e.getUint32(a+4);a+=8;l={name:h,id:m,length:l};c.refsByName[c.browser.regularizeReferenceName(h)]=l;c.refsByNumber[m]=l}else a+=g,h=e.getUint64(a),a+=8,h-=c.chromTreeOffset,f(h)};f(32);a.call(c,c)}else c._failAllDeferred("Web browser does not support typed arrays")},b)},hasRefSeq:function(a,b,c){var e=this,a=e.browser.regularizeReferenceName(a);this._deferred.features.then(function(){b(a in e.refsByName)},c)},_getFeatures:function(b,
c,e,f){var h=this.browser.regularizeReferenceName(b.ref),i=b.start,j=b.end;(b=b.basesPerSpan?this.getView(1/b.basesPerSpan):b.scale?this.getView(b.scale):this.getView(1))?b.readWigData(h,i,j,dojo.hitch(this,function(b){a.forEach(b||[],c);e()}),f):e()},getUnzoomedView:function(){if(!this.unzoomedView){var a=4E3;this.zoomLevels[0]&&(a=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset);this.unzoomedView=new l(this,this.unzoomedIndexOffset,a,!1)}return this.unzoomedView},getView:function(a){if(!this.zoomLevels||
!this.zoomLevels.length)return null;if(!this._viewCache||this._viewCache.scale!=a)this._viewCache={scale:a,view:this._getView(a)};return this._viewCache.view},_getView:function(a){var a=1/a,b=this.zoomLevels.length;for(this.fileSize||b--;0<b;b--){var c=this.zoomLevels[b];if(c&&c.reductionLevel<=2*a)return new l(this,c.indexOffset,b<this.zoomLevels.length-1?this.zoomLevels[b+1].dataOffset-c.indexOffset:this.fileSize-4-c.indexOffset,!0)}return this.getUnzoomedView()},saveStore:function(){return{urlTemplate:this.config.blob.url}}})});